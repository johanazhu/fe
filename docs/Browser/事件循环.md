# 事件循环
微任务和宏任务
面试题


一个线程中，事件循环是唯一的，但是任务队列可以拥有多个

任何队列又分为macro-task（宏任务）与micro-task（微任务），在最新标准中，他们被分别称为task与jobs

macro-task大概包括：script(整体代码)，setTimeout,setInterval,setImmediate,I/O,UI rendering

micro-task大概包括：procss,nextTick,Promise,Obect.observe(已废弃)，MutationObserver（html5新特性）

setTimeout/Promise等我们称之为任务源

```javascript
// setTimeout中的回调函数才是进入任务队列的任务
setTimeout(function() {
    console.log('xxxx');
})
// setTimeout作为一个任务分发器，这个函数会立即执行，而它所要分发的任务，也就是它的第一个参数，才是延迟执行
```

先执行宏任务（同步代码），然后执行所有的微任务，然后再在下一个宏任务中执行，再执行这个宏任务中的所有微任务

执行过程中，遇到不同的任务分发器，就将任务分发到各自对应的队列中去

如果出现两次setTimeout，都会先进入setTimeout队列

只有当setTimeout中所有的任务执行完毕之后，才会再次开始执行微任务队列

当我们在执行setTimeout任务中遇到setTimeout时，它仍然会将对应的任务分发到setTimeout队列中去，但是该任务就得等到下一轮事件循环执行了。例子中没有涉及到这么复杂的嵌套，大家可以动手添加或者修改他们的位置来感受一下循环的变化。

#### Event loop执行顺序

1.执行同步代码，属于宏任务

2.执行站为空，查询是否有微任务需要执行

3.执行所有的微任务

4.必要的话渲染UI

5.然后开始下一轮 Event loo，执行宏任务中的代步代码

微任务包括：provess.nextTick，promise，Object.observe，MutationObserver

宏任务包括：script，setTimeout，setInterval，setImmediate，I/O，UI rendering