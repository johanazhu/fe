# æ‹·è´çš„ç§˜å¯†

å‰æ–‡[JavaScriptç”±ä»€ä¹ˆç»„æˆ](./JavaScriptç”±ä»€ä¹ˆç»„æˆ.md)ä¸­è®²è¿°äº†JavaScript çš„æ•°æ®ç±»å‹åˆ†ä¸ºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ï¼Œè€ŒåŒºåˆ†ä¸¤åˆ™çš„ä¾æ®æ˜¯åŸºæœ¬ç±»å‹æ˜¯â€è½»é‡â€œçš„ï¼Œå®ƒå­˜åœ¨æ ˆå†…å­˜ä¸­ï¼Œè€Œå¼•ç”¨ç±»å‹æ¯”è¾ƒé‡ï¼Œå®ƒå­˜åœ¨å †å†…å­˜ä¸­ã€‚æ‰€ä»¥å½“åŸºæœ¬ç±»å‹æ‹·è´æ—¶ï¼Œèƒ½ç›´æ¥æ‹·è´ï¼Œå¼•ç”¨ç±»å‹æ‹·è´æ—¶ï¼Œæ‹·è´çš„ä¸æ˜¯å¯¹è±¡ï¼ˆå¼•ç”¨ç±»å‹æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ•°æ®ç±»å‹â€”â€”å¯¹è±¡ï¼‰ï¼Œè€Œæ˜¯è¯¥å¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€

åœ¨[ä¸€åˆ‡çš†å¯¹è±¡](./ä¸€åˆ‡çš†å¯¹è±¡.md)ä¸­ï¼Œæˆ‘ä»¬æ›¾ç»æ¸…æ™°åœ°è¡¨è¾¾ä¸€ä¸ªè§‚ç‚¹ï¼Œåœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œé™¤å» undefinedã€nullå¤–ï¼Œä¸€åˆ‡çš†å¯¹è±¡ã€‚å¯¹è±¡åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é¢‘ç¹ç”¨åˆ°çš„ä¸€ç‚¹æ˜¯èµ‹å€¼æ‹·è´ï¼Œè€Œå½“ä½ æ‹·è´å‡ºé”™æ—¶ï¼Œæƒ…å†µä¼šå¾ˆç³Ÿç³•ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™èŠ‚å°±æ˜¯ä¸ºè®²è§£å¯¹è±¡ä¸­çš„æ‹·è´è€Œç”Ÿ

## æ­£æ–‡

é¦–å…ˆ JavaScript æ²¡æœ‰ä¸å¯å˜æ•°æ®ç»“æ„ï¼Œä¸å¯å˜æ•°æ®ç»“æ„æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­å¿…å¤‡çš„

å¯å˜çš„å¥½å¤„æ˜¯èŠ‚çœå†…å­˜æˆ–æ˜¯åˆ©ç”¨å¯å˜æ€§åšä¸€äº›äº‹æƒ…ï¼Œä½†æ˜¯åœ¨å¤æ‚çš„å¼€å‘ä¸­å®ƒçš„å‰¯ä½œç”¨è¿œæ¯”å¥½å¤„å¤§å¾—å¤šï¼Œäºæ˜¯æœ‰äº†æµ…æ‹·è´å’Œæ·±æ‹·è´

ç¬”è€…è¿™é‡Œæœ‰å‡ ä¸ªè‡ªé—®è‡ªç­”çš„è§£é‡Š

- å¯¹è±¡ä¸ºä»€ä¹ˆæ˜¯æ‹·è´åœ°å€ï¼Ÿ
  - ä¸ºäº†æ€§èƒ½ï¼ˆèŠ‚çœå†…å­˜ï¼‰ï¼Œè¯•æƒ³å¦‚æœæ¯ä¸ªå¯¹è±¡éƒ½æ˜¯æ‹·è´å€¼ï¼Œé‚£å¯¹è±¡ä¸€å¤§/å¤šï¼Œå ç”¨çš„å†…å­˜å°±ä¼šå‡ ä½•ä¸Šå‡
- å¦‚ä½•æ‹·è´å¯¹è±¡çš„å€¼
  - Object.assign
  - æ‰©å±•è¿ç®—ç¬¦
  - sliceï¼ˆæ•°ç»„æ–¹æ³•ï¼‰
  - concatï¼ˆæ•°ç»„æ–¹æ³•ï¼‰
  - JSON.stringify

è¿™äº”ç§æ–¹æ³•éƒ½èƒ½æ‹·è´å¯¹è±¡çš„å€¼ï¼Œè€Œå‰å››è€…æ˜¯æµ…æ‹·è´ï¼ŒJSON.stringify æ˜¯æ·±æ‹·è´

ä»€ä¹ˆæ˜¯æµ…æ‹·è´ï¼Ÿä»€ä¹ˆåˆæ˜¯æ·±æ‹·è´ï¼Ÿ

-   æµ…æ‹·è´æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯¹åŸå§‹å¯¹è±¡å±æ€§å€¼è¿›è¡Œå¤åˆ¶

    -   å±æ€§æ˜¯åŸºç¡€ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼Œä¿®æ”¹å†…å®¹ä¸å½±å“
    -   å±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€ï¼Œä¿®æ”¹å†…å®¹äº’ç›¸å½±å“

-   æ·±æ‹·è´ï¼šæ•´ä¸ªå¯¹è±¡æ‹·è´åˆ°å¦ä¸€ä¸ªå†…å­˜ä¸­ï¼Œä¿®æ”¹å†…å®¹äº’ä¸å½±å“

è¯´å¾—ç›´ç™½ç‚¹ï¼Œæµ…æ‹·è´åªæ‹·è´ä¸€å±‚ï¼Œæ·±æ‹·è´ç›´æ¥å¤åˆ¶å¯¹è±¡

ä¸»è¦åŒºåˆ«åœ¨äºï¼š

1. æ‹·è´å¯¹è±¡çš„æ·±åº¦ä¸åŒ
   - æµ…æ‹·è´ï¼šåªå¤åˆ¶å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ï¼Œå­å¯¹è±¡ä»ç„¶æŒ‡å‘åŸå§‹å¯¹è±¡
   - æ·±æ‹·è´ï¼šå®Œå…¨å¤åˆ¶æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬åµŒå¥—çš„å­å¯¹è±¡ï¼Œä¸åŸå§‹å¯¹è±¡å®Œå…¨ç‹¬ç«‹
2. å†…å­˜å ç”¨ä¸åŒï¼š
   - æµ…æ‹·è´ï¼šåªå¤åˆ¶æŒ‡é’ˆï¼Œå†…å­˜å ç”¨æ›´å°
   - æ·±æ‹·è´ï¼šå¤åˆ¶å¯¹è±¡çš„å…¨éƒ¨å†…å®¹ï¼Œå†…å­˜å ç”¨æ›´å¤§
3. å¯¹å¯¹è±¡çš„ä¿®æ”¹çš„å½±å“ä¸åŒ
   - æµ…æ‹·è´ï¼šä¿®æ”¹å­å¯¹è±¡ä¼šå½±å“æ‹·è´å’ŒåŸå§‹å¯¹è±¡
   - æ·±æ‹·è´ï¼šä¿®æ”¹å­å¯¹è±¡ä¸ä¼šå½±å“æ‹·è´å’ŒåŸå§‹å¯¹è±¡

ä¸ºä»€ä¹ˆè¦æœ‰æµ…æ‹·è´ï¼Œç›´æ¥æ·±æ‹·è´ä»£æ›¿ä¸å°±å¥½äº†ã€‚å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜åŒæ ·æœ‰ç½‘å‹æå‡ºâ€”â€”[JSçš„æµ…æ‹·è´ç©¶ç«Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ](https://www.zhihu.com/question/294117087)ï¼Œè™½ç„¶ç¬”è€…æ²¡æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œä½†æ€€ç–‘è¿˜æ˜¯å› ä¸ºæ€§èƒ½ï¼Œæµ…æ‹·è´èƒ½åº”ä»˜å¾ˆå¤šåœºæ™¯ï¼Œéä¸å¿…è¦ä¸ç”¨æ·±æ‹·è´ã€‚åœ¨è®¾è®¡ä¸Šè®©å¼€å‘è€…å°‘ç”¨ï¼Œæ— å½¢ä¸­æé«˜å¼€å‘ä½“éªŒ

## Object.assign

Object.assign()æ–¹æ³•å¯ä»¥æŠŠä»»æ„å¤šä¸ªåŸå¯¹è±¡è‡ªèº«çš„å¯æšä¸¾å±æ€§æ‹·è´ç»™ç›®æ ‡å¯¹è±¡ï¼Œç„¶åè¿”å›ç›®æ ‡å¯¹è±¡

å®ƒæ‹·è´çš„æ˜¯å¯¹è±¡çš„å±æ€§çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«

æ˜¯ ES6 ä¸­ Object å¯¹è±¡æ–°å¢çš„æ–¹æ³•

å‚æ•°ï¼š

targetï¼šç›®æ ‡å¯¹è±¡

sources: ä»»æ„å¤šä¸ªåŸå¯¹è±¡ã€‚

è¿”å›å€¼ï¼šç›®æ ‡å¯¹è±¡ä¼šè¢«è¿”å›

é€‚ç”¨å¯¹è±¡ï¼šObject

æ¡ˆä¾‹ä¸€ï¼š

```javascript
var obj1 = { a: 10, b: 20, c: 30 };
var obj2 = Object.assign({}, obj1);
obj2.b = 100;
console.log(obj1); // {a: 10, b: 20, c: 30}
console.log(obj2); // {a: 10, b: 100, c: 30}
```

æ¡ˆä¾‹äºŒï¼š

```javascript
var obj = { a: { a: 'hello', b: 21 } };
var initialObj = Object.assign({}, obj);

initialObj.a.a = 'changed';
console.log(obj.a.a); // "change"
```

å¯ä»¥çœ‹å‡ºï¼ŒObject åªèƒ½æ‹·è´ç¬¬ä¸€å±‚å¯¹è±¡ï¼Œå¦‚æœå†å¾€æ·±ä¸€å±‚æ‹·è´ï¼Œå°±æœ‰é—®é¢˜äº†ã€‚æ‰€ä»¥Object.assign æ˜¯æµ…æ‹·è´

## æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰

æ‰©å±•è¿ç®—ç¬¦ï¼Œå¯ä»¥åœ¨å‡½æ•°è°ƒç”¨/æ•°ç»„æ„é€ æ—¶ï¼Œå°†æ•°ç»„è¡¨è¾¾å¼æˆ–è€… string åœ¨è¯­æ³•å±‚é¢å±•å¼€ï¼›è¿˜å¯ä»¥åœ¨æ„é€ å­—é¢é‡å¯¹è±¡æ—¶ï¼Œå°†å¯¹è±¡è¡¨è¾¾å¼æŒ‰ key-value çš„æ–¹å¼å±•å¼€

è¯šç„¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å±•å¼€è¿ç®—ç¬¦çš„ä½œç”¨å¹¶ä¸æ˜¯ä¸ºäº†æ‹·è´ã€‚ä½†æ— å¯åšéï¼Œæµ…æ‹·è´ä¹Ÿæ˜¯å±•å¼€è¿ç®—ç¬¦çš„åŠŸèƒ½ç‚¹ä¹‹ä¸€

é€‚ç”¨å¯¹è±¡ï¼šObject/Array 

æ¡ˆä¾‹ä¸€ï¼šä¸€ç»´æ•°ç»„

```javascript
var arr = [1, 2, 3];
var arr2 = [...arr];
arr2.push(4);

// arr2 [1, 2, 3, 4]
// arr1 ä¸å—å½±å“
```

æ¡ˆä¾‹äºŒï¼šå¤šç»´æ•°ç»„

```javascript
var a = [
    [1, 2],
    [3, 4],
    [5, 6],
];
var b = [...a];
b.shift().shift();
// b [[3, 4], [5, 6]]
// a [[2], [3, 4], [5, 6]]
```

æ‰©å±•è¿ç®—ç¬¦ä¹Ÿæ˜¯æµ…æ‹·è´

## slice

**slice()** æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡æ˜¯ä¸€ä¸ªç”± `begin` å’Œ `end` å†³å®šçš„åŸæ•°ç»„çš„æµ…æ‹·è´ï¼ˆåŒ…æ‹¬ `begin`ä¸åŒ…æ‹¬ `end` ï¼‰ã€‚åŸå§‹æ•°ç»„ä¸ä¼šè¢«æ”¹å˜

é€‚ç”¨å¯¹è±¡ï¼šArray 

æ¡ˆä¾‹ï¼š

```javascript
const family = [
    'father',
    'mother',
    'brother',
    ['sister0', 'sister1', 'sister2'],
];
const copyFamily = family.slice();
copyFamily[0] = 'father1';
copyFamily[3][1] = 'brother1';
console.log(family); // ['father', 'mother', 'brother', ['sister0' , 'brother1', 'sister2']]
console.log(copyFamily); // ['father1', 'mother', 'brother', ['sister0' , 'brother1', 'sister2']]
// å¤åˆ¶ä¸€å±‚ï¼Œç¬¬äºŒå±‚å¼€å§‹å¼•ç”¨
```

å¦‚ä¸Šæ¡ˆä¾‹ï¼Œslice åªèƒ½å¤åˆ¶ä¸€å±‚ï¼Œç¬¬äºŒå±‚å°±æ˜¯å¤åˆ¶å¼•ç”¨åœ°å€äº†ï¼Œslice ä¹Ÿæ˜¯æµ…æ‹·è´

## concat

concat() æ–¹æ³•ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„ã€‚æ­¤æ–¹æ³•ä¸ä¼šæ”¹å˜ç°æœ‰æ•°ç»„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„

é€‚ç”¨å¯¹è±¡ï¼šArray 

```javascript
const array1 = ['a', 'b', ['c0', 'c1', 'c2']];
const array2 = array1.concat();
array2[1] = 'B';
array2[2][1] = 'C1';
console.log(array1); // ['a', 'b', ['c0', 'C1', 'c2']]
console.log(array2); // ['a', 'B', ['c0', 'C1', 'c2']]
// å¤åˆ¶ä¸€å±‚ï¼Œç¬¬äºŒå±‚å¼€å§‹å¼•ç”¨
```

concat åŒ sliceï¼Œéƒ½æ˜¯é’ˆå¯¹æ•°ç»„çš„æµ…æ‹·è´

## å¦‚ä½•å®ç°æµ…æ‹·è´

ç®€å•æ¥è¯´ï¼Œæµ…æ‹·è´åªå¤åˆ¶ä¸€å±‚å¯¹è±¡çš„å±æ€§

hasOwnProperty çš„ä½œç”¨æ˜¯åˆ¤æ–­å¯¹è±¡è‡ªèº«å±æ€§ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§

```javascript
function shallowClone(source) {
    if (typeof source === 'object' && source !== null) {
        var target = Array.isArry(source) ? [] : {};
        for (let prop in source) {
            if (source.hasOwnProperty(prop)) {
                target[prop] = source[prop];
            }
        }
        return target;
    } else {
        return source;
    }
}
```

ç»¼ä¸Šåˆ†æï¼ŒJavaScript çš„æµ…æ‹·è´æœ‰ 4 ç§ï¼Œé’ˆå¯¹æ•°ç»„çš„æµ…æ‹·è´æœ‰ sliceã€concatï¼Œé’ˆå¯¹å¯¹è±¡çš„ Object.assign() ï¼Œè¿˜æœ‰å°±æ˜¯é€‚ç”¨æ•°ç»„å’Œå¯¹è±¡çš„æ‰©å±•è¿ç®—ç¬¦(...)

## æ·±æ‹·è´çš„åŸç†

æµ…æ‹·è´åªæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¤åˆ¶äº†åŸæœ‰å¯¹è±¡çš„åŸºæœ¬ç±»å‹çš„å€¼ï¼Œè€Œå¼•ç”¨ç±»å‹åªæ‹·è´äº†ä¸€å±‚å±æ€§ï¼Œå†æ·±å±‚çš„å°±æ— æ³•æ‹·è´ã€‚æ·±æ‹·è´åˆ™ä¸åŒï¼Œå®ƒä¼šåœ¨å †å†…å­˜ä¸­å¼€è¾Ÿä¸€å—å†…å­˜åœ°å€ï¼Œå°†åŸæœ‰å¯¹è±¡å®Œå…¨å¤åˆ¶è¿‡æ¥

> æ·±æ‹·è´çš„æ˜¯å°†ä¸€ä¸ªå¯¹è±¡ä»å†…å­˜ä¸­å®Œæ•´åœ°æ‹·è´å‡ºæ¥ä¸€ä»½ç»™ç›®æ ‡å¯¹è±¡ï¼Œå¹¶ä»å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªå…¨æ–°çš„ç©ºé—´å­˜æ”¾æ–°å¯¹è±¡ï¼Œä¸”æ–°å¯¹è±¡çš„ä¿®æ”¹å¹¶ä¸ä¼šæ”¹å˜å…ƒå¯¹è±¡ï¼ŒäºŒè€…å®ç°çœŸæ­£çš„åˆ†ç¦»

ç®€å•å½’çº³ï¼šæ·±æ‹·è´æ˜¯é€’å½’å¤åˆ¶äº†æ‰€æœ‰å±‚çº§ä¸­å¯¹è±¡çš„å±æ€§

### JSON.stringify

```javascript
var arr = [1, 2, 3, 4, { value: 5 }];
var arr1 = JSON.parse(JSON.stringify(arr));
arr[4].value = 6;
console.log(arr1); //[1, 2, 3, 4, { value: 5 }]

var obj = {
    name: "johan",
    address: {city: "shanghai"}
}
var obj1 = JSON.parse(JSON.stringify(obj));
obj.address.city = "beijing";
console.log(obj1); //{name: "johan", address:{city: "shanghai"}
```

è™½ç„¶ JSON.stringify èƒ½å®ç°å¯¹æ•°ç»„å’Œå¯¹è±¡çš„æ·±æ‹·è´ï¼Œä½†å®ƒå´æœ‰å‡ ä¸ªå‘

- å®ƒæ— æ³•å®ç°å¯¹å‡½æ•°ã€RegExp ç­‰ç‰¹æ®Šå¯¹è±¡çš„å…‹éš†
- å®ƒä¼šæŠ›å¼ƒå¯¹è±¡çš„ constructorï¼Œæ‰€æœ‰çš„æ„é€ å‡½æ•°ä¼šæŒ‡å‘ Object
- å¯¹è±¡æœ‰å¾ªç¯å¼•ç”¨ï¼Œä¼šæŠ¥é”™

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹è¿™å‡ ä¸ªå‘ï¼Œ

```javascript
// æ„é€ å‡½æ•°
function Person(name) {
    this.name = name;
}

const Elaine = new Person('elaine');

// å‡½æ•°
function say() {
    console.log('hi');
}

const oldObj = {
    a: say,
    b: new Array(1),
    c: new RegExp('ab+c', 'i'),
    d: Elaine,
};

const newObj = JSON.parse(JSON.stringify(oldObj));

// æ— æ³•å¤åˆ¶å‡½æ•°
console.log(newObj.a, oldObj.a); // undefined [Function: say]
// ç¨€ç–æ•°ç»„å¤åˆ¶é”™è¯¯
console.log(newObj.b[0], oldObj.b[0]); // null undefined
// æ— æ³•å¤åˆ¶æ­£åˆ™å¯¹è±¡
console.log(newObj.c, oldObj.c); // {} /ab+c/i
// æ„é€ å‡½æ•°æŒ‡å‘é”™è¯¯
console.log(newObj.d.constructor, oldObj.d.constructor); // [Function: Object] [Function: person]
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å¯¹å‡½æ•°ã€æ­£åˆ™å¯¹è±¡ã€‚ç¨€ç–æ•°ç»„ç­‰å¯¹è±¡å…‹éš†æ—¶ä¼šå‘ç”Ÿæ„å¤–ï¼Œæ„é€ å‡½æ•°æŒ‡å‘ä¹Ÿä¼šå‘ç”Ÿé”™è¯¯

```javascript
const oldObj = {};
oldObj.a = oldObj;

const newObj = JSON.parse(JSON.stringify(oldObj));
console.log(newObj.a, oldObj.a); // TypeError: Converting circular structure to JSON
```

å¯¹è±¡çš„å¾ªç¯å¼•ç”¨ä¼šæŠ›å‡ºé”™è¯¯

 JSON.stringify æ·±æ‹·è´èƒ½è§£å†³ç°å®ä¸­çš„å¤§éƒ¨åˆ†åœºæ™¯ï¼Œä½†ç¼ºé™·ä¹Ÿè®©å…¶æˆäº†é¢è¯•ä¸­çš„å¸¸å®¢ï¼Œç°åœ¨æˆ‘ä»¬æŒ‘æˆ˜ä¸‹æ‰‹å†™æ·±æ‹·è´

### æ‰‹å†™æ·±æ‹·è´

æ·±æ‹·è´çš„è¦é¢†æ˜¯é€’å½’+æ·±æ‹·è´

æˆ‘ä»¬å…ˆå®ç°ä¸€ä¸ªé’ˆå¯¹æ•°ç»„å’Œå¯¹è±¡çš„æ·±æ‹·è´

```javascript
function deepClone(source) {
    // é’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹
    if (typeof source !== 'object' || source === null ) {
        return source
    }
    // åˆ¤æ–­å®ƒæ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡
    // æˆ–è€… let target = source instanceof Array ? [] : {}
    let target = Array.isArray(source) ? [] : {}
    // å¾ªç¯éå†å¤åˆ¶æ¯ä¸ªå±æ€§
    for (let prop in source) {
         // è‡ªæœ‰å±æ€§æ‰åšæ‹·è´
        if (source.hasOwnProperty(prop)) {
           // åˆ¤æ–­è‡ªæœ‰å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡
            target[prop] = typeof source[prop] === 'object' ? deepClone(source[prop]) : source[prop]
        }
    }
    return target
}
```

ä»¥ä¸Šæ˜¯ç®€å•çš„æ·±æ‹·è´ï¼Œä¸ JSON.stringify çš„æ·±æ‹·è´æ•ˆæœå¤§å·®ä¸å·®ã€‚å®ƒä»¬åŒæ ·å­˜åœ¨çš„ç¼ºç‚¹æ˜¯ï¼š

- å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¯¹è±¡ä¹‹é—´äº’ç›¸å¼•ç”¨ï¼Œå½¢æˆæ— é™å¾ªç¯ï¼‰æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡ºé”™è¯¯
- ä»¥ Symbol ç±»å‹ä¸ºå±æ€§å€¼çš„å±æ€§éƒ½ä¼šè¢«å¿½ç•¥æ‰
- ç¼ºå°‘é’ˆå¯¹å…¶ä»–çš„å†…ç½®æ„é€ å‡½æ•°çš„å…¼å®¹ï¼Œå¦‚ Functionã€RegExpã€Dateã€Setã€Map

æˆ‘ä»¬ä½¿ç”¨ WeakMap æ¥è§£å†³å¾ªç¯å¼•ç”¨ï¼Œå¦‚è¦å…¶ä»–æ•°æ®ç±»å‹ï¼ŒåŠ ä¸Šä¾¿æ˜¯

è¿™é‡Œè¯´æ˜ä¸€ä¸‹ä¸ºä»€ä¹ˆç”¨ WeakMap æ¥è§£å†³å¾ªç¯å¼•ç”¨ï¼Œä»¥åŠå®ƒä¸ Map çš„åŒºåˆ«

è¦æƒ³è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå¯ä»¥é¢å¤–å¼€è¾Ÿä¸€å—å­˜å‚¨ç©ºé—´ï¼Œæ¥å­˜å‚¨å½“å‰å¯¹è±¡å’Œæ‹·è´å¯¹è±¡çš„å¯¹åº”å…³ç³»ï¼Œå½“æ‹·è´æ—¶ï¼Œå…ˆä»ç©ºé—´ä¸­æ‰¾ï¼Œæ‰¾åˆ°ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰çš„è¯æ­£å¸¸æ‹·è´

è€Œè¿™ç±»æ•°æ®ç»“æ„å¯ä»¥ç”¨ mapã€WeakMap ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äº

- WeakMap å¯¹è±¡æ˜¯ä¸€ç»„é”®/å€¼å¯¹çš„é›†åˆï¼Œå…¶ä¸­çš„é”®æ˜¯å¼±å¼•ç”¨ã€‚å…¶é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„çš„ã€‚Mapçš„é”®å¯ä»¥æ˜¯ä»»æ„çš„ï¼ŒåŒ…æ‹¬å‡½æ•°ã€å¯¹è±¡æˆ–ä»»æ„åŸºæœ¬ç±»å‹
- WeakMap æ˜¯å¼±å¼•ç”¨ï¼Œå¯ä»¥è¢«åƒåœ¾å›æ”¶ã€‚Map çš„é”®ä¸å†…å­˜ç»‘å®š
- Map å¯ä»¥è¢«éå†ï¼ŒWeakMap ä¸èƒ½è¢«éå†

ç®€å•æ¥è¯´ï¼Œå› ä¸º WeakMap æ˜¯å¼±å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰å…¶ä»–å¼•ç”¨å­˜åœ¨æ—¶åƒåœ¾å›æ”¶èƒ½æ­£å¸¸è¿›è¡Œ

```javascript
function deepClone(source, storage = new WeakMap()) {
    // é’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹
    if (typeof source !== 'object' || source === null) {
        return source
    }
    // æ˜¯å¦æ˜¯æ—¥æœŸ
    if (source.constructor === Date) {
        return new Date(source)
    }
    // æ˜¯å¦æ˜¯æ­£åˆ™
    if (source.constructor === RegExp) {
        return new RegExp(source)
    }
    // æ˜¯å¦æ˜¯æ•°ç»„
    let target = source instanceof Array ? [] : {}
    // å¾ªç¯å¼•ç”¨ è¿”å›å­˜å‚¨çš„å¼•ç”¨æ•°æ®
    if (storage.has(source)) return storage.get(source)
    // å¼€è¾Ÿå­˜å‚¨ç©ºé—´è®¾ç½®ä¸´æ—¶å­˜å‚¨å€¼
    storage.set(source, target)
    // æ˜¯å¦åŒ…å« Symbol ç±»å‹
    let isSymbol = Object.getOwnPropertySymbols(source)
    // åŒ…å« Symbol ç±»å‹
    if (isSymbol.length) {
        isSymbol.forEach((item) => {
            if (typeof source[item] === 'object') {
                target[item] = deepClone(source[item], storage);
                return
            }
            target[item] = source[item]
        })
    }
    // ä¸åŒ…å« Symbol
    for(let key in source) {
        if (source.hasOwnProperty(key)) {
            target[key] = typeof source[key] === 'object' ? deepClone(source[key], storage) : source[key]
        }
    }
    return target;
}
```

ç¬”è€…çš„è¿™ä¸ªæ·±æ‹·è´è‚¯å®šä¸æ˜¯æœ€å…¨çš„ï¼Œéå¤§ä½¬å†™å‡ºçš„è®©é¢è¯•å®˜æƒŠè‰³çš„æ·±æ‹·è´å¯æ¯”ã€‚ç¬”è€…åªèƒ½è¯´æä¾›ä¸€ä¸¢ä¸¢æ·±æ‹·è´çš„æ€è·¯

## æ€»ç»“

æ·±æ‹·è´æ˜¯å‰ç«¯é¢è¯•ä¸­å¿…è€ƒçš„ä¸€é¡¹ï¼Œä»–è‹¥é—®ä½ æ€ä¹ˆæ‰‹å†™ï¼Œä½ è‹¥æ˜¯åªå†™äº† JSON.parse(JSON.stringify(source))è‚¯å®šæ˜¯ä¸åˆæ ¼çš„ã€‚å†™ hasOwnProperty ä¹Ÿåªèƒ½é è¾¹ç«™ï¼Œè€Œå¦‚æœè§£å†³å¾ªç¯å¼•ç”¨ã€Symbolã€å„ä¸ªæ•°æ®ç±»å‹æ‹·è´ç­‰é—®é¢˜ï¼Œæ‰èƒ½è¯´æ˜ä½ æ˜ç™½äº†æ·±æ‹·è´



## æ›´æ–°ï¼šstructuredClone

JavaScript è‡ªå¸¦çš„æ‹·è´ï¼Œéƒ½æ˜¯æµ…æ‹·è´ï¼Œç°åœ¨æµè§ˆå™¨å¼•å…¥ä¸€ä¸ªå…¨å±€å‡½æ•°`structuredClone()`ï¼Œç”¨æ¥æ·±æ‹·è´ã€‚

å®ƒé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨ï¼ˆæˆªè‡³ 2022 å¹´ï¼‰å’Œ Node.jsï¼ˆæˆªè‡³ v17ï¼‰

æ€ä¹ˆä½¿ç”¨ï¼š

```javascript
const obj = { name: 'johan', friends: [{ name: 'elaine' }] };
const clonedObj = structuredClone(obj);

console.log(obj.name === clonedObj); // false
console.log(obj.friends === clonedObj.friends); // false 
```

ä¸ JSON.parse(JSON.stringify(source)) ä¸åŒçš„ï¼ŒstructuredClone() å…è®¸å¾ªç¯å¼•ç”¨

```javascript
const car = {
  make: 'Toyota',
};

car.basedOn = car;

const cloned = structuredClone(car);

console.log(car.basedOn === cloned.basedOn); // false

// ğŸ‘‡ Circular reference is cloned
console.log(car === car.basedOn); // true     
```

ç¼ºç‚¹ï¼š

ä¸èƒ½å…‹éš†å‡½æ•°æˆ–æ–¹æ³•

```javascript
function func() {}

// Error: func could not be cloned
const funcClone = structuredClone(func);  

// or
const car = {
  make: 'BMW',
  move() {
    console.log('vroom vroom..');
  },
};

car.basedOn = car;
// âŒ Error: move() could not be cloned
const cloned = structuredClone(car);  
```







## å‚è€ƒèµ„æ–™

-   [ä½¿ç”¨ slice å’Œ concat å¯¹æ•°ç»„çš„æ·±æ‹·è´å’Œæµ…æ‹·è´](https://www.cnblogs.com/baiyangyuanzi/p/6518218.html)
-   [å¦‚ä½•å†™å‡ºä¸€ä¸ªæƒŠè‰³é¢è¯•å®˜çš„æ·±æ‹·è´](https://www.conardli.top/docs/JavaScript/%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D.html)
-   [é—²åº­ä¿¡æ­¥èŠå‰ç«¯ - ä¸€æ–‡æ‘¸æ¸… ES æ‹·è´çš„æ·±æµ…](https://zhuanlan.zhihu.com/p/338443023?utm_source=wechat_session&utm_medium=social&utm_oi=56197411504128)
-   [å¦‚ä½•å†™å‡ºä¸€ä¸ªæƒŠè‰³é¢è¯•å®˜çš„æ·±æ‹·è´?](https://juejin.cn/post/6844903929705136141)
