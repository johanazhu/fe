# 闭包



为什么将闭包和作用域放一起？因为闭包是由作用域引起的								——前言

### 为什么要有闭包？

我们去了解一个概念时，如果先问一句，为什么会有它（这个概念），往往很多东西就能不攻自破

为什么会由闭包，它产生的原因是什么，解决了什么？

我们不妨试想一下以下场景。你实现一个 web 应用，写了很多页面，同样引入了一些库和框架，自己又写了很多工具函数，当他们在一个（全局）作用域下，就会引发变量冲突问题（虽然我们强调命名规范问题，但实际开发总会遇到命名相同等问题）

假设你定义了一个变量a，一个函数b，直接写在全局环境下，这个模块实现了功能A。

现在我们的程序需要开发功能B，你也想用变量a，函数b标识符来表示，那就尴尬了，因为已经在功能A上使用过，不能再使用，而如果不用变量a和函数b标识符来表示语义化上又不洽淡。

你也许想到了c、d两个名字，但是当你调试时，发现原来这两个标识符也已经被其他的工具函数使用过。

命名冲突的原因是因为 **同作用域下已存在相同的变量名**，要解决以上问题，就要从作用域上下手

即——**一个模块应该有自己的作用域，来保证模块的正常运行**

全局作用域肯定不行，我们只用函数作用域可以实现这一功能。SO 我们要讲的闭包本质上就是一个函数作用域

它的作用是对模块中变量的保护。即在函数作用域中写好所有流程后，讲这个要使用的变量return语句暴露到外界

```javascript
function foo() {
    var a = '我是 foo 的私有变量，只能在 foo 中使用';
    function b() {
        console.log('我是 foo 中的私有函数，只能在 foo 中使用')
    }
    function closuresab() { // 将 foo 中的私有变量打包到 closuresab中
        b();
     	console.log(a)   
    }
    return closuresab
}
var bar = foo()
bar() 
// 我是 foo 中的私有函数，只能在 foo 中使用
// 我是 foo 的私有变量，只能在 foo 中使用
```

这就是闭包的作用。闭包其实只是一个绑定了执行环境的函数

#### 我的理解

因为作用域是词法作用域，函数内定义的变量函数外不能使用。如果我想调用函数内的变量呢？怎么破？返回调用变量的函数，这样作用域就释放不了，这就是闭包

```javascript
function foo(){
    var a = 2; // 私有变量，属于 foo
    return function() { // 返回一个匿名函数，匿名函数中调用a
        a++
        console.log(a)
    }
}
var bar = foo() // 将 foo 函数赋值给 bar
bar() // 3
bar() // 4
```

如上所示，我明明在函数外面，但是我还是调用了函数里面的变量。我们再来个例子一下

```javascript
function foo(){
    return function(name) { // 返回一个回调函数
        console.log(name)
    }
}
var bar = foo() // 将 foo 函数赋值给 bar
bar('elaine') // elaine
```

是不是很熟悉，回调函数竟然是闭包

Jquery中有大量的回调函数例子：

```javascript
function setupBot(name, selector) {
    $(selector).click(function() {
        console.log('调用', name)
    })
}
setupBot('closure Bot 1', '#bot1')
setupBot('closure Bot 2', '#bot2')
```

我们可以得出这样的结论：只要使用了**回调函数**，实际上就是在使用闭包！

好了，这就是本章的内容

我们想了解了作用域是什么？再从它的根部出发，解释它是词法作用域的一面，再将它分类，全局作用域，函数作用域，块级作用域（eval作用域不推荐，就没探讨），以循环中的定时器为例子，讲述了三种解决方案。

作用域链很简单，没有过多阐述。闭包的原理也相对简单，本质是函数作用域，其概念是：利用函数作用域保护自由变量，并且返回了对被保护变量的引用，这种行为就是闭包。

闭包无处不在，比如我们熟悉的回调函数，只要使用了就自然有闭包。

记住，闭包是一种机制，是行为，它返回了对保护变量的引用





深入javascript——作用域和闭包

https://segmentfault.com/a/1190000000618597







#### 闭包

什么是：即重用一个变量，又保护变量不被篡改的一个机制

为什么会有它

​	全局变量： 优：可重用

​						缺：造成全局污染，易被篡改

​	局部变量： 优：仅函数内可使用，不会污染全局，也不会被篡改

​						缺：不可重用

何时：只要希望重用一个变量，又保护变量不被污染

闭包的题目很多
hook也是用了闭包的机制
要多写一些案例

react hooks 中有闭包陷阱

被压着释放不了



说说我对JavaScript 闭包的理解

https://juejin.im/post/5a65cfa4f265da3e377c2491



重温基础：闭包

https://mp.weixin.qq.com/s?__biz=MzIyMDc3NTEyNA==&mid=2247484083&idx=1&sn=67c1763e172a8192ce2a4d1f0f025e51&chksm=97c79508a0b01c1e738d976ef06f8a55d207765cbe22f8646092caa5d42c291f1ab941ea76e8&mpshare=1&scene=1&srcid=&sharer_sharetime=1568854610501&sharer_shareid=778ad5bf3b27e0078eb105d7277263f6#rd