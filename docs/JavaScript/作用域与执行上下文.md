# 作用域与执行上下文



**作用域在函数定义时就已经确定了，而不是在函数调用时确定**

**执行上下文取决函数调用时的各种条件**

**this的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式**





执行上下文是一个抽象的环境，JavaScript 代码在其中执行。当全局代码执行时，它将在全局执行上下文中执行，而函数代码将在函数执行上下文中执行



每次只能有一个执行上下文处于运行状态，因为 JavaScript 是单线程语言，它由执行栈或者调用栈来管理



执行堆栈是具有LIFO（后进先出）结构的堆栈，只能从堆栈顶部添加或删除项目



**词法环境**

每当 JavaScript 引擎创建执行上下文来执行该函数或全局代码时，它就会创建一个新的词法环境来存储在该函数执行期间该函数中定义的变量



词法环境是一个存储标记符和变量映射关系的数据结构。标识符值得是变量或者函数的名字，变量指的是实际的对象，包括函数或者原始值。



词法环境包括三个部分：（1）环境记录；（2）`outer`外部环境的指向；（3）`this`

1. 环境记录是存储变量和函数声明的地方
2. `outer`，外部环境的指向表示它可以访问外层（父层）的词法环境。它是理解必报原理的关键。





函数完成后，其执行上下文将从堆栈中删除，但是它的词法环境可能会也可能不会从内存中删除，具体取决于该词法环境是否被其他词法环境引用（取决于是否存在闭包）





执行上下文在函数被调用的时候产生，它包含了变量对象、作用域链、this值



**执行上下文在ES3中**，包含了三个部分

- scope：作用域，也常常被叫做作用域链
- variable object：变量对象，用于存储变量的对象
- this value：this 值

在ES5中，我们改进了命名方式，把执行上下文最初的三个部分改成下面这个样子

- lexical environment：词法环境，当获取变量时使用
- variable environment：变量环境，当声明变量时使用
- this value：this 值

































