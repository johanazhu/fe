# 执行上下文

#### 执行上下文栈

当执行一个函数的时候，就会创建一个执行上下文，并压入执行上下文栈，当函数执行完毕的时候，就会将函数的执行上下文从栈中弹出



JavaScript采用此法作用域，也就是静态作用域

```javascript
var value = 1;

function foo() {
    console.log(value);
}

function bar() {
    var value = 2;
    foo();
}

bar(); // 1
```

静态，根据书写找


#### 作用域（scope）和上下文（context）

作用域是指变量的可访问性，上下文是指this在同一作用域内的值

JS有执行上下文

首先有个全局执行上下文

然后每次进入其他作用域就会创建对应的执行上下文并把它压入执行栈的顶部

一旦对应的上下文执行完毕，就从栈顶弹出，并将上下文控制权交给当前的栈

这样依次执行



原理：四个阶段

1.程序开始执行前：

​	在内存中创建执行环境栈（数组）：

​			**执行环境栈** ：依次保存正在调用的函数的数组

​					函数调用后，会出栈

​	在栈中首先添加浏览器主函数的调用

​	创建全局作用域对象window

​	主函数引用全局作用域对象window

2.定义函数时

​	在window中用函数名创建变量

​	在window外创建函数对象保存函数的内容

​	函数名变量通过地址引用函数对象

​	函数对象用隐藏的scope属性，引用回自己诞生的作用域对象，——万一运行时缺东西，可以找诞生的作用域要！

3.函数调用时

​	在执行环境栈中添加当前函数调用

​	为本次函数调用创建活动对象AO

​		什么是活动对象：专门为 保存本次函数调用所需的局部变量的对象——就是**函数作用域对象**

​	在活动对象中保存函数的局部变量

​	活动对象通过隐藏的作用域链属性引用window

​	变量的使用顺序：先用AO中的局部变量，局部没有，在往window上找

4.函数调用后

​	函数的调用从ECS中出栈

​		导致：函数作用域对象AO释放

​			导致：局部变量一同释放！

作用域链：由多级作用域对象，逐级引用形成的链式结构

​	作用：存储所有变量（局部变量和全局变量）

​				控制着变量的使用顺序，先局部再全局

scope作用域，可以理解为籍贯