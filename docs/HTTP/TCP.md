# TCP/IP 协议及网络分层模型

互联网要互联连接，从我发一条微信到你回复一条微信，一个信息从接受到回应，都需要走一遍网络协议。那么我们讲讲 TCP/IP 协议

网络分层模型

- TCP/IP
  - 四层
- OSI
  - 七层





### TCP/IP 网络分层模型

![TCP/IP 网络分层模型](https://s2.loli.net/2022/03/29/l3m8kJDCf5ZdjSh.png)

TCP/IP 协议总共有四层，就像搭积木一样，每一层需要下层的支撑，同时又支撑着上层，任何一层被抽掉都可能会导致整个协议栈坍塌。

第一层叫 **链接层** （link layer），负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 **MAC 地址来标记网络上的设备** ，所以有时候也叫 MAC 层。

第二层叫 **网际层** 或者 **网络互连层** （internet layer），IP 协议就处在这一层。因为 IP 协议定义了 **IP 地址** 的概念，所以就可以在 **链接层** 的基础上，**用 IP 地址取代 MAC 地址** ，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把 IP 地址再「翻译」成 MAC 地址就可以了。

第三层叫 **传输层**（transport layer），这个层次协议的职责是保证数据在 IP 地址标记的两点之间可靠地传输，是 TCP 协议工作的层次，另外还有它的一个小伙伴 UDP。

**TCP 是一个有状态的协议，需要先与对方建立连接然后才能发送数据** ，而且保证数据不丢失不重复。而 UDP 则比较简单，它无状态，不用事先建立连接就可以任意发送数据，但不保证数据一定会发到对方。两个协议的另一个重要区别在于数据的形式。TCP 的数据是连续的字节流，有先后顺序，而 UDP 则是分散的小数据包，是顺序发，乱序收。

关于 TCP 和 UDP 可以展开讨论的话题还有很多，比如最经典的「三次握手」和「四次挥手」，一时半会很难说完，好在与 HTTP 的关系不是太大，以后遇到了再详细讲解。

协议栈的第四层叫 **应用层** （application layer），由于下面的三层把基础打得非常好，所以在这一层就百花齐放了，有各种面向具体应用的协议。例如 Telnet、SSH、FTP、SMTP 等等，当然还有我们的 HTTP。

- MAC 层的传输单位是帧（frame）
- IP 层的传输单位是包（packet）
- TCP 层的传输单位是段（segment）
- HTTP 的传输单位则是消息或报文（message）

### OSI 网络分层模型

第二个网络分层模型：**OSI** ，全称是 **开放式系统互联通信参考模型** （Open System Interconnection Reference Model）。

![OSI 网络分层模型](https://s2.loli.net/2022/03/29/pLzfhyXKHosTR6Z.png)

1. 第一层：物理层，网络的物理形式，例如电缆、光纤、网卡、集线器等等；
2. 第二层：数据链路层，它基本相当于 TCP/IP 的链接层；
3. 第三层：网络层，相当于 TCP/IP 里的网际层；
4. 第四层：传输层，相当于 TCP/IP 里的传输层；
5. 第五层：会话层，维护网络中的连接状态，即保持会话和同步；
6. 第六层：表示层，把数据转换为合适、可理解的语法和语义；
7. 第七层：应用层，面向具体的应用传输数据。

不过国际标准组织心里也很清楚，TCP/IP 等协议已经在许多网络上实际运行，再推翻重来是不可能的。所以，OSI 分层模型在发布的时候就明确地表明是一个「参考」，不是强制标准，意思就是说，「你们以后该干什么还干什么，我不管，但面子上还是要按照我说的来」。



### 两个分层模型的映射关系

现在我们有了两个网络分层模型：TCP/IP 和 OSI，新的问题又出现了，一个是四层模型，一个是七层模型，这两者应该如何互相映射或者说互相解释呢？

好在 OSI 在设计之初就参考了 TCP/IP 等多个协议，可以比较容易但不是很精确地实现对应关系。

![两个分层模型的映射关系](https://s2.loli.net/2022/03/29/NGdR1VHo4LeXDb7.png)

1. 第一层：物理层，TCP/IP 里无对应；
2. 第二层：数据链路层，对应 TCP/IP 的链接层；
3. 第三层：网络层，对应 TCP/IP 的网际层；
4. 第四层：传输层，对应 TCP/IP 的传输层；
5. 第五、六、七层：统一对应到 TCP/IP 的应用层。

### TCP/IP 协议栈的工作方式

你可以把 HTTP 利用 TCP/IP 协议栈传输数据想象成一个发快递的过程。

![TCP/IP 协议栈的工作方式](https://s2.loli.net/2022/03/29/quf6FtHB5mK1dk9.png)

这次我们学习了 HTTP 所在的网络分层模型，它是工作中常用的交流语言，在这里简单小结一下今天的内容。

1. TCP/IP 分为四层，核心是二层的 IP 和三层的 TCP，HTTP 在第四层；
2. OSI 分为七层，基本对应 TCP/IP，TCP 在第四层，HTTP 在第七层；
3. OSI 可以映射到 TCP/IP，但这期间一、五、六层消失了；
4. 日常交流的时候我们通常使用 OSI 模型，用四层、七层等术语；
5. HTTP 利用 TCP/IP 协议栈逐层打包再拆包，实现了数据传输，但下面的细节并不可见。

有一个辨别四层和七层比较好的（但不是绝对的）小窍门，**两个凡是**：

- 凡是由操作系统负责处理的就是四层或四层以下，
- 否则，凡是需要由应用程序（也就是你自己写代码）负责处理的就是七层。















总结：

-   互联网中的数据是通过数据包来传输的，数据包在传输过程中容易丢失或出错
-   IP 负责把数据包送达目的主机
-   UDP 负责把数据包送达具体应用
-   而 TCP 保证了数据完整地传输，它的连接可以分为三个阶段：建立连接、传输数据和断开连接
-   其实了解 TCP 协议，是为了全方位了解 HTTP，包括其实际功能和局限性，之后才会更加深刻地理解为什么要推出 HTTP/2，以及为什么要推出 QUIC 协议，也就是未来的 HTTP/3。这是一个由浅入深、循序渐进的过程

一个 TCP 连接过程包括建立连接、传输数据和断开连接三个阶段

而 HTTP 协议，正是建立在 TCP 连接基础之上的。HTTP 是一种允许浏览器向服务器获取资源的协议，是 Web 的基础

# udp

网络通讯概述

ip 地址（重点）

Linux 命令

端口（重点）

socker 简介

udp 网络程序-发送-接收

python3 编译转换

udp 绑定端口问题（重点）

网络通讯过程（简单版）

案例：udp 聊天器

## 网络通讯概述

### 1.什么是网络





HTTP 协议以及相关的协议



![协议栈](https://s2.loli.net/2022/04/03/TaMG2juFeVWLEZs.png)



## TCP/IP协议

TCP/IP 协议实际上是一系列网络通信协议的统称，其中最核心的两个协议是 **TCP** 和 **IP** ，其他的还有 UDP、ICMP、ARP 等等，共同构成了一个复杂但有层次的协议栈。

#### TCP/IP 网络分层模型

HTTP 通信是分层的，从上到下有：应用层、传输层、网络层、链路层。

应用层：HTTP

- 有各种面向具体应用的协议。例如 Telnet、SSH、FTP、SMTP 等等，当然还有我们的 HTTP
- 

传输层：TCP

- 这个层次协议的职责是保证数据在 IP 地址标记的两点之间可靠地传输，是 TCP 协议工作的层次，另外还有它的一个小伙伴 UDP。
- **TCP 是一个有状态的协议，需要先与对方建立连接然后才能发送数据** ，而且保证数据不丢失不重复。而 UDP 则比较简单，它无状态，不用事先建立连接就可以任意发送数据，但不保证数据一定会发到对方。两个协议的另一个重要区别在于数据的形式。TCP 的数据是连续的字节流，有先后顺序，而 UDP 则是分散的小数据包，是顺序发，乱序收。

网络层：IP

- IP 协议定义了 IP 地址，用 IP 地址取代 MAC 地址

链路层：Network

- 负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 **MAC 地址来标记网络上的设备** ，所以有时候也叫 MAC 层。



- MAC 层的传输单位是帧（frame）
- IP 层的传输单位是包（packet）
- TCP 层的传输单位是段（segment）
- HTTP 的传输单位则是消息或报文（message）



**IP 协议** 是 **Internet Protocol** 的缩写，**主要目的是解决寻址和路由问题，以及如何在两点间传送数据包** 。IP 协议使用 **IP 地址** 的概念来定位互联网上的每一台计算机。可以对比一下现实中的电话系统，你拿着的手机相当于互联网上的计算机，而要打电话就必须接入电话网，由通信公司给你分配一个号码，这个号码就相当于 IP 地址。

**TCP 协议**是 `Transmission Control Protocol` 的缩写，意思是 **传输控制协议** ，它位于 IP 协议之上，基于 IP 协议提供可靠的、字节流形式的通信，是 HTTP 协议得以实现的基础。



### OSI 网络分层模型

第二个网络分层模型：**OSI** ，全称是 **开放式系统互联通信参考模型** （Open System Interconnection Reference Model）。

1. 第一层：物理层，网络的物理形式，例如电缆、光纤、网卡、集线器等等；
2. 第二层：数据链路层，它基本相当于 TCP/IP 的链接层；
3. 第三层：网络层，相当于 TCP/IP 里的网际层；
4. 第四层：传输层，相当于 TCP/IP 里的传输层；
5. 第五层：会话层，维护网络中的连接状态，即保持会话和同步；
6. 第六层：表示层，把数据转换为合适、可理解的语法和语义；
7. 第七层：应用层，面向具体的应用传输数据。



1. 第一层：物理层，TCP/IP 里无对应；
2. 第二层：数据链路层，对应 TCP/IP 的链接层；
3. 第三层：网络层，对应 TCP/IP 的网际层；
4. 第四层：传输层，对应 TCP/IP 的传输层；
5. 第五、六、七层：统一对应到 TCP/IP 的应用层。



1. TCP/IP 分为四层，核心是二层的 IP 和三层的 TCP，HTTP 在第四层；
2. OSI 分为七层，基本对应 TCP/IP，TCP 在第四层，HTTP 在第七层；
3. OSI 可以映射到 TCP/IP，但这期间一、五、六层消失了；
4. 日常交流的时候我们通常使用 OSI 模型，用四层、七层等术语；
5. HTTP 利用 TCP/IP 协议栈逐层打包再拆包，实现了数据传输，但下面的细节并不可见。







## 参考资料

-   [本文把 TCP/IP 讲绝了！](https://mp.weixin.qq.com/s/EhkbUZYX_P7XJFQ5471HaQ)
-   [一文串联 HTTP、TCP、IP、以太网](https://mp.weixin.qq.com/s?__biz=Mzg4MTYwMzY1Mw==&mid=2247496571&idx=1&sn=3532002eb4a2f4d4cd54cb6bfc934f05&source=41#wechat_redirect)
-   [TCP 协议：如何保证页面文件能被完整送达浏览器](https://blog.poetries.top/browser-working-principle/guide/part1/lesson02.html#%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E2%80%9C%E6%97%85%E7%A8%8B%E2%80%9D)
-   [被问到 http 的时候你就这么回答](https://mp.weixin.qq.com/s/7uuypNid-1iNlXavTFHp7w)
