import{_ as s,c as a,o as n,d as l}from"./app.590c1fbf.js";const C=JSON.parse('{"title":"网页长按保存及识别二维码","description":"","frontmatter":{},"headers":[{"level":2,"title":"前期准备","slug":"前期准备","link":"#前期准备","children":[]},{"level":2,"title":"实战开始","slug":"实战开始","link":"#实战开始","children":[{"level":3,"title":"字体的运用","slug":"字体的运用","link":"#字体的运用","children":[]},{"level":3,"title":"二维码功能的实现","slug":"二维码功能的实现","link":"#二维码功能的实现","children":[]},{"level":3,"title":"快照实现","slug":"快照实现","link":"#快照实现","children":[]},{"level":3,"title":"canvas2image 的坑点","slug":"canvas2image-的坑点","link":"#canvas2image-的坑点","children":[]}]},{"level":2,"title":"参考资料","slug":"参考资料","link":"#参考资料","children":[]}],"relativePath":"WebApp/网页长按保存图片及识别二维码.md"}'),p={name:"WebApp/网页长按保存图片及识别二维码.md"},e=l(`<h1 id="网页长按保存及识别二维码" tabindex="-1">网页长按保存及识别二维码 <a class="header-anchor" href="#网页长按保存及识别二维码" aria-hidden="true">#</a></h1><p><a href="http://d.news.163.com/#/h5" target="_blank" rel="noreferrer">网易哒哒</a>的 H5 一向是业界精品，其中不少 H5 会成为爆款，能在朋友圈广泛流传的那种。同时，他们还写了一本很水的书——<a href="https://book.douban.com/subject/35131526/" target="_blank" rel="noreferrer">制造爆款：H5营销策划一本通</a>，草草介绍了下各式各样的H5，但相关的技术文章却都没这么介绍，笔者一直想仿做类似的H5，找来找去，也只找到两篇网易同厂的技术类文章：</p><ul><li><a href="https://musicfe.dev/canvas-snapshot/" target="_blank" rel="noreferrer">高质量前端快照方案：来自页面的「自拍」</a></li><li><a href="https://musicfe.dev/color-quiz/" target="_blank" rel="noreferrer">官方揭秘！你的颜色是这样算出来的</a></li></ul><p>就此，笔者做个简易H5，介绍一下个人认为H5中比较重要的功能点——长按保存图片及识别二维码</p><p>此项目主要用到三个库</p><ul><li><p><a href="https://html2canvas.hertzen.com/" target="_blank" rel="noreferrer">html2canvas</a>：将HTML 转换为 canvas</p></li><li><p><a href="https://github.com/hongru/canvas2image" target="_blank" rel="noreferrer">canvas2image</a>：将 canvas 转换为图片</p></li><li><p><a href="https://www.npmjs.com/package/qrcodejs2" target="_blank" rel="noreferrer">qrcodejs2</a>：生成二维码</p></li></ul><h2 id="前期准备" tabindex="-1">前期准备 <a class="header-anchor" href="#前期准备" aria-hidden="true">#</a></h2><p>设计稿：魔改公司H5中的其中一页</p><p>字体：寻找开源字体，这款不错——<a href="https://github.com/lxgw/LxgwWenKai" target="_blank" rel="noreferrer">LXGW WenKai / 霞鹜文楷</a></p><p>此外，就是布局，笔者在<a href="https://blog.azhubaby.com/2021/12/29/2021-12-22-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B3%95%E9%97%A8%EF%BC%9A%E8%87%AA%E9%80%82%E5%BA%94%E6%96%B9%E6%A1%88%E5%92%8C%E9%AB%98%E6%B8%85%E6%96%B9%E6%A1%88/" target="_blank" rel="noreferrer">移动端法门：自适应方案和高清方案</a> 中阐述过一个观点：</p><blockquote><p>不同的布局方式作用不同，像新闻类的H5，采用 px 为单位，是为了让大手机看到更多的信息；像应用型的H5，采用 rem/vw 为单位，力求在各种手机上能保持一致UI</p></blockquote><p>像营销页面，是希望在各种手机上保持UI一致，理论上采用 rem/vw 是没问题的，但是 ggvswild 在<a href="https://musicfe.dev/canvas-snapshot/" target="_blank" rel="noreferrer">高质量前端快照方案：来自页面的「自拍」</a> 中曾说：</p><blockquote><p>为了给到<code>html2canvas</code>明确的整数计算值，避免因小数舍入而导致的拉伸模糊，建议将布局中使用中使用<code>%</code>、<code>vw</code>、<code>vh</code>或<code>rem</code>等单位的元素样式，统一改为使用<code>px</code></p></blockquote><p>而笔者在实际项目开发时，采用 rem 为单位并没有发现拉伸模糊问题。除此之外，笔者又寻找了几个网易的 H5</p><ul><li><a href="https://st.music.163.com/c/yourposter/m1/index.html" target="_blank" rel="noreferrer">关于你的画</a>，网易云音乐出品，采用 % + js + 绝对定位布局</li><li><a href="https://st.music.163.com/c/gameofthrones" target="_blank" rel="noreferrer">权力的游戏</a>，网易云音乐出品，采用 % + js + 绝对定位布局</li><li><a href="https://st.music.163.com/st-color-quiz/index" target="_blank" rel="noreferrer">测一测属于你的主导色</a>，网易云音乐出品，采用 rem/vw + 绝对定位布局</li><li><a href="https://wp.m.163.com/163/page/news/food_2022/index.html" target="_blank" rel="noreferrer">这100种人生必吃美食，你打卡了哪些</a>，网易哒哒出品，采用 px + 绝对定位布局</li></ul><p>个人总结：在布局上它们都使用绝对定位布局，在长度单位上各有特色，所以做 H5 布局是无所谓用那种方式，只要在截图页不让元素拉伸即可，也就是说如果拉伸模糊了，可查一下此元素的单位是否是小数，至于其他页的布局，习惯用那个就用那个</p><h2 id="实战开始" tabindex="-1">实战开始 <a class="header-anchor" href="#实战开始" aria-hidden="true">#</a></h2><h3 id="字体的运用" tabindex="-1">字体的运用 <a class="header-anchor" href="#字体的运用" aria-hidden="true">#</a></h3><p>字体「 霞鹜文楷」大约4.4M，太大了，用 <a href="https://github.com/ecomfe/fontmin" target="_blank" rel="noreferrer">fontmin</a> 提取用到的字体，这里我直接使用 <a href="http://ecomfe.github.io/fontmin/#app" target="_blank" rel="noreferrer">Fontmin 的客户端</a>，无它，命令行执行出错，营销页只用到了9个汉字，裁剪后从4.4M减少到 44kb</p><h3 id="二维码功能的实现" tabindex="-1">二维码功能的实现 <a class="header-anchor" href="#二维码功能的实现" aria-hidden="true">#</a></h3><p>很简单，看文档就能学会</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> qrcode </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">qrcode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">QRCode</span><span style="color:#A6ACCD;">(qrcode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">width</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">colorDark</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#000000</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">colorLight</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#ffffff</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">correctLevel</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> QRCode</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">CorrectLevel</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">L</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">makeCode</span><span style="color:#A6ACCD;">(window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">href)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="快照实现" tabindex="-1">快照实现 <a class="header-anchor" href="#快照实现" aria-hidden="true">#</a></h3><p>将 html2canvas 和 canvas2image 结合，将 HTML 转成 base64 图片，而这一功能可以做成一个库：</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> convertToImage </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createBaseCanvas</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">scale</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">width</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">height</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canvas</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">canvas</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">width</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">width</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scale</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">height</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scale</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">context</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getContext</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2d</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 关闭抗锯齿</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mozImageSmoothingEnabled</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">webkitImageSmoothingEnabled</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">msImageSmoothingEnabled</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">imageSmoothingEnabled</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">scale</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">scale</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scale</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">convertToImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">container</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scale</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">devicePixelRatio</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">width</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">offsetWidth</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">height</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">offsetHeight</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canvas</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createBaseCanvas</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">scale</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">width</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">height</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ops</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            useCORS</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 如果截图的内容里有图片,解决文件跨域问题</span></span>
<span class="line"><span style="color:#F07178;">            allowTaint</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 是否允许跨源图像污染画布</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">options</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">html2canvas</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ops</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">canvas</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">imageEl</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Canvas2Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">convertToPNG</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">width</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">imageEl</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">convertToImage</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>使用：</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">convertToImage</span><span style="color:#A6ACCD;">(document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#capture</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">imageEl</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementsByClassName</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">save</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">appendChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">imageEl</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="canvas2image-的坑点" tabindex="-1">canvas2image 的坑点 <a class="header-anchor" href="#canvas2image-的坑点" aria-hidden="true">#</a></h3><ol><li><p>最新版本（1.4.1）已支持缩放，已解决图片不清晰的问题</p><ul><li>图片不清晰以前是个大问题，不少博文都有对其说明，目前的版本没看到模糊</li></ul></li><li><p><a href="https://html2canvas.hertzen.com/features" target="_blank" rel="noreferrer">文档</a>上写支持 <code>background-image:linear-gradient()</code>，但是如果是渐变至透明是不行的</p></li></ol><p><img src="https://s2.loli.net/2022/07/12/7pAcHuVnzI9ZTEs.png" alt="渐变背景色"></p><p>而我希望呈现这样的样式：</p><p><img src="https://s2.loli.net/2022/07/12/LTm8MA6JezwdaRr.png" alt="背景图"></p><p>背景渐变方案：</p><div class="language-css line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">background-image</span><span style="color:#A6ACCD;">: linear-gradient(90deg</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> $white</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> transparent);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>改成背景图：</p><div class="language-css line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">background: url(&#39;.</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">/bg.png&#39;) </span><span style="color:#FFCB6B;">no-repeat</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">background-size</span><span style="color:#A6ACCD;">: 100% 100%;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>文字会出现位移，这个问题至今<a href="https://github.com/niklasvh/html2canvas/issues/2769" target="_blank" rel="noreferrer">一直存在</a>，作者也没有修复</li></ol><p>以上就是所遇到的问题，像跨域之类的问题，随着时间的推移，文档上都有说明，已经不是什么问题</p><p>线上预览地址：<a href="http://azhubaby.com/demo/WeChat/canvas-snapshot/index.html" target="_blank" rel="noreferrer">这里</a></p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-hidden="true">#</a></h2><ul><li><a href="https://musicfe.dev/canvas-snapshot/" target="_blank" rel="noreferrer">高质量前端快照方案：来自页面的「自拍」</a></li><li><a href="https://musicfe.dev/color-quiz/" target="_blank" rel="noreferrer">官方揭秘！你的颜色是这样算出来的……</a></li><li><a href="https://github.com/whinc/whinc.github.io/issues/8" target="_blank" rel="noreferrer">H5 实现保存图片的采坑记录</a></li></ul>`,41),o=[e];function r(t,c,y,F,i,D){return n(),a("div",null,o)}const b=s(p,[["render",r]]);export{C as __pageData,b as default};
