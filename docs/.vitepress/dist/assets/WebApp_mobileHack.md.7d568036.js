import{_ as s,c as a,o as n,d as l}from"./app.590c1fbf.js";const b=JSON.parse('{"title":"mobileHack","description":"","frontmatter":{},"headers":[{"level":3,"title":"白屏解决与优化方案","slug":"白屏解决与优化方案","link":"#白屏解决与优化方案","children":[]},{"level":3,"title":"如何实现打开已安装的 app，若未安装则引导用户安装？","slug":"如何实现打开已安装的-app-若未安装则引导用户安装","link":"#如何实现打开已安装的-app-若未安装则引导用户安装","children":[]},{"level":2,"title":"神奇的 iframe","slug":"神奇的-iframe","link":"#神奇的-iframe","children":[]},{"level":2,"title":"参考资料","slug":"参考资料","link":"#参考资料","children":[]}],"relativePath":"WebApp/mobileHack.md"}'),e={name:"WebApp/mobileHack.md"},p=l(`<h1 id="mobilehack" tabindex="-1">mobileHack <a class="header-anchor" href="#mobilehack" aria-hidden="true">#</a></h1><h3 id="白屏解决与优化方案" tabindex="-1">白屏解决与优化方案 <a class="header-anchor" href="#白屏解决与优化方案" aria-hidden="true">#</a></h3><p>当前很多无线页面都是用前端模板进行数据渲染，那么在糟糕的网速情况下，一进去页面，看到的不是白屏就是 loading，这称为白屏问题。</p><p>此问题发生的原因基本可以归结为网速跟静态资源</p><p>1、css 文件加载需要一些时间，在加载的过程中页面是空白的。</p><p>解决：可以考虑将 css 代码前置和内联。</p><p>2、首屏无实际的数据内容，等待异步加载数据在渲染页面导致白屏</p><p>解决：在首页直接同步渲染 html，后续的滚屏等再采用异步请求数据和渲染 html</p><p>3、首屏内联 js 的执行会阻塞页面的渲染。</p><p>解决：尽量不在首屏 html 代码中房子内联脚本</p><h4 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-hidden="true">#</a></h4><p>根本原因是客户端渲染的无力，因此最简单的方法是咋服务器端，使用模板引起渲染所有页面。同时</p><p>1 减少文件加载体积，如 html 压缩，js 压缩</p><p>2 加快 js 执行速度，比如常见的无限滚动的页面，可以使用 js 先渲染一个屏幕范围内的东西</p><p>3 提高一些优化的交互，比如提供一些假的滚动条</p><p>4 使用本地存储处理静态文件</p><h3 id="如何实现打开已安装的-app-若未安装则引导用户安装" tabindex="-1">如何实现打开已安装的 app，若未安装则引导用户安装？ <a class="header-anchor" href="#如何实现打开已安装的-app-若未安装则引导用户安装" aria-hidden="true">#</a></h3><p>来自 <a href="http://gallery.kissyui.com/redirectToNative/1.2/guide/index.html" target="_blank" rel="noreferrer">http://gallery.kissyui.com/redirectToNative/1.2/guide/index.html</a> kissy mobile 通过 iframe src 发送请求打开 app，自定义 url scheme，如 taobao://home(淘宝首页)、etao://scan（一淘扫描）;如果安装了客户端则会直接唤起，直接唤起后，之前浏览器窗口（或者扫码工具的 webview）推入后台；如果在指定的时间内客户端没有被唤起，则 js 重定向到 app 下载地址。大概实现代码如下</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">goToNative</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">appendChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">iframe</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">appendChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">iframe</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">removeChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">iframe</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">gotoDownload</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">stratTime</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// 去下载，下载链接一般是 itunes app store 或者 apk 文件链接</span></span>
<span class="line"><span style="color:#89DDFF;">   	</span><span style="color:#676E95;font-style:italic;">// 测试时间设置小于800ms时，在android下的UC浏览器会打开native appp时并下载apk，</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 测试android+UC下打开native的时候最好大于800ms</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">800</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>需要注意的是 如果是 android chrome 25 版本以后，在 iframe src 不会发送请求，原因如下 <a href="https://developers.google.com/chrome/mobile/docs/intents" target="_blank" rel="noreferrer">https://developers.google.com/chrome/mobile/docs/intents</a> ，通过 loacation href 使用 intent 机制拉起客户端可行并且当前页面不跳转</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">intent://</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">    schemeUrl </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#Intent;scheme=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">    scheme </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">;package=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">    self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">package </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">;end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="神奇的-iframe" tabindex="-1">神奇的 iframe <a class="header-anchor" href="#神奇的-iframe" aria-hidden="true">#</a></h2><p>Flutter 开发的App引用，打开企业微信客服，返回时会白屏</p><p>起初用的是 location.href</p><p>例如</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">href </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://work.weixin.qq.com/kfid/xxx</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>不行，后来同事用 iframe 打开可以</p><p>我很惊讶，iframe 不是嵌入代码吗，怎么能打开，于是向同事要了代码</p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">iframe</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">iframe</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">frameborder</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">style</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">opacity: 0;position: absolute;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">iframe</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> iframe </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">iframe</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  iframe</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAttribute</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://work.weixin.qq.com/kfid/xxxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;	</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>神奇，给 iframe 赋值，竟然能唤起企业微信</p><p>这不 hack 吗</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-hidden="true">#</a></h2><ul><li><a href="https://js8.in/2013/12/16/ios%E4%BD%BF%E7%94%A8schema%E5%8D%8F%E8%AE%AE%E8%B0%83%E8%B5%B7app/" target="_blank" rel="noreferrer">iOS 使用 scheme 协议调起 APP</a></li><li><a href="https://github.com/RubyLouvre/mobileHack" target="_blank" rel="noreferrer">司徒正美的 mobileHack</a></li><li><a href="https://github.com/suoyuesmile/suo-blog/blob/master/articals/h5/0003.md" target="_blank" rel="noreferrer">12 个前端必会 H5 问题及解决方法</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&amp;mid=2247490207&amp;idx=1&amp;sn=82e08108f953fa541304b8bfc318fb30&amp;source=41#wechat_redirect" target="_blank" rel="noreferrer">微信 H5 页面兼容性解决方案</a></li><li><a href="https://github.com/yunzhijia/front-end/blob/master/web%20app%E9%97%AE%E9%A2%98%E5%8F%8A%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.md" target="_blank" rel="noreferrer">web app 问题及技巧总结</a></li><li><a href="https://github.com/jtyjty99999/mobileTech" target="_blank" rel="noreferrer">mobileTech</a></li><li><a href="https://www.open-open.com/lib/view/open1449325854077.html" target="_blank" rel="noreferrer">H5 项目常见问题汇总及解决方案</a></li><li><a href="https://github.com/suoyuesmile/suo-blog/blob/master/articals/h5/0003.md" target="_blank" rel="noreferrer">移动端 H5 相关问题汇总</a></li><li><a href="https://juejin.cn/post/6844903615304302600" target="_blank" rel="noreferrer">如何写一个适配 iPhoneX 的底部导航</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&amp;mid=2247490207&amp;idx=1&amp;sn=82e08108f953fa541304b8bfc318fb30&amp;source=41#wechat_redirect" target="_blank" rel="noreferrer">微信 H5 页面兼容性解决方案</a></li><li><a href="https://juejin.cn/post/6844903940190896135" target="_blank" rel="noreferrer">微信浏览器禁止页面下拉查看网址</a></li><li><a href="http://www.imooc.com/article/260139" target="_blank" rel="noreferrer">移动 web 开发踩坑总结</a></li><li><a href="https://segmentfault.com/a/1190000012761272" target="_blank" rel="noreferrer">iOS Safari 浏览器上 overflow: scroll 元素无法滑动 bug 解决方法整理</a></li><li><a href="https://segmentfault.com/a/1190000016408566" target="_blank" rel="noreferrer">iOS safari 浏览器上 overflow: scroll 元素无法滚动 bug 深究</a></li></ul>`,33),o=[p];function r(t,c,i,D,y,F){return n(),a("div",null,o)}const d=s(e,[["render",r]]);export{b as __pageData,d as default};
