import{_ as s,c as a,o as p,d as n}from"./app.590c1fbf.js";const A=JSON.parse('{"title":"前端学Ruby：论坛全栈项目","description":"","frontmatter":{},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"知识点总结","slug":"知识点总结","link":"#知识点总结","children":[]},{"level":2,"title":"初始化项目","slug":"初始化项目","link":"#初始化项目","children":[]},{"level":2,"title":"附录","slug":"附录","link":"#附录","children":[{"level":3,"title":"ruby-china api 接口","slug":"ruby-china-api-接口","link":"#ruby-china-api-接口","children":[]},{"level":3,"title":"cnode api 设计","slug":"cnode-api-设计","link":"#cnode-api-设计","children":[]}]}],"relativePath":"BackEnd/Ruby/前端学Ruby：论坛全栈项目.md"}'),l={name:"BackEnd/Ruby/前端学Ruby：论坛全栈项目.md"},e=n(`<h1 id="前端学ruby-论坛全栈项目" tabindex="-1">前端学Ruby：论坛全栈项目 <a class="header-anchor" href="#前端学ruby-论坛全栈项目" aria-hidden="true">#</a></h1><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-hidden="true">#</a></h2><p>我们上个项目做了一个 api 项目，只用到了 ruby on rails 中的一部分能力。这篇文章，笔者将做一个论坛类的全栈项目，用 ruby on rails 来全栈开发</p><p>因为笔者是前端的缘故，所以对数据库设计这块比较薄弱，所以本次开发的UI和API都是模仿来的，严格意义来说，这是一次基于别人的 API 以及别人的 UI 而模仿做的一此论坛项目</p><p>此项目 API 方面考察了 <a href="https://cnodejs.org/api" target="_blank" rel="noreferrer">cnodejs</a>、<a href="https://api.ruby-china.org/" target="_blank" rel="noreferrer">ruby-china</a> 以及 <a href="https://www.v2ex.com/help/api" target="_blank" rel="noreferrer">v2ex</a> 这三个论坛的 API，最后打算采用ruby-china 的 api 作为本项目的参考对象，v2ex 公开的 api 数量太少，cnode 相较 ruby-china 的 api 简单，笔者想弄个稍微复杂点的，能对自己能力有所提高的项目，以及 ruby-china 是用 <a href="https://github.com/ruby-china/homeland" target="_blank" rel="noreferrer">ruby on rails</a> 写的，多多少少可以参考一下，所以 API 这块就参考 ruby-china</p><p>UI 方面，笔者从 <a href="https://discuss.rubyonrails.org/" target="_blank" rel="noreferrer">ruby on rails 论坛</a> 以及 <a href="https://meta.appinn.net/" target="_blank" rel="noreferrer">小众软件论坛</a> 得知了 <a href="https://www.discourse.org/" target="_blank" rel="noreferrer">discourse</a>，它是用 ruby on rails 写的开源论坛 sass 应用，项目地址：<a href="https://github.com/discourse/discourse%E3%80%82" target="_blank" rel="noreferrer">https://github.com/discourse/discourse。</a></p><p>UI 和 API 设计以及数据库（同API一样参考 ruby-china）有了参考对象后，论坛项目就能正式开始了</p><p>笔者将此论坛称为菩萨（Buddha），有人会问文字这么大，其实，笔者一项有乱起名字的爱好，所以这次项目也延续以往的传统</p><h2 id="知识点总结" tabindex="-1">知识点总结 <a class="header-anchor" href="#知识点总结" aria-hidden="true">#</a></h2><p>rails 最佳实践</p><p>注册登录</p><p>jwt、数据库的连接、单元测试、接口文档、部署</p><h2 id="初始化项目" tabindex="-1">初始化项目 <a class="header-anchor" href="#初始化项目" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">rails</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--database</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">postgresql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--css</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bootstrap</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--skip-test</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buddha</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>上个项目没有做单元测试，这个项目中会使用</p></blockquote><p>项目建好后，命令行<code>rails s</code>，报错：</p><p><img src="https://s2.loli.net/2023/02/23/Sh3HK8JRGjLE2wa.png" alt="报错信息"></p><p>说明我们数据库没连上，创建postgresql 的用户名和数据库名</p><p><img src="https://s2.loli.net/2023/02/23/gStElfdCm6DLIOk.png" alt="创建postgresql"></p><p>再去 <code>config/database.yml</code> 中修改开发环境时的数据库</p><div class="language-yml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">development</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;&lt;:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">*</span><span style="color:#A6ACCD;">default</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">database</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buddha_development</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buddha</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123456</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">localhost</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>重启启动项目 <code>rails s</code>，项目就正常运行了</p><p>我们先搞话题（topics）部分的 API，按照 ruby-china 中的</p><p>先建立话题模型（model），然后根据模型</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">rails</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">g</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">model</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">topic</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://s2.loli.net/2023/02/23/Oy7ziYSfwAo4ZGT.png" alt="建模"></p><p>修改<code> db/migrate/20230219025936_create_topics.rb</code> 的内容</p><div class="language-ruby line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CreateTopics</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ActiveRecord::Migration</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">7.0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">change</span></span>
<span class="line"><span style="color:#A6ACCD;">    create_table </span><span style="color:#89DDFF;">:topics</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">integer </span><span style="color:#89DDFF;">:id,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 话题编号</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">string </span><span style="color:#89DDFF;">:title,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 标题</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">string </span><span style="color:#89DDFF;">:node_name,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 节点名字</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">integer </span><span style="color:#89DDFF;">:node_id,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 节点 ID </span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">boolean </span><span style="color:#89DDFF;">:excellent</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 是否精华</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">boolean </span><span style="color:#89DDFF;">:deleted</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 是否已删除</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">integer </span><span style="color:#89DDFF;">:replies_count,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">default:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 回帖数量</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">integer </span><span style="color:#89DDFF;">:likes_count,</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">default:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 赞数量</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">integer </span><span style="color:#89DDFF;">:last_reply_user_id</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 最后回复人用户编号</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">string </span><span style="color:#89DDFF;">:last_reply_user_login</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 最后回复者 login</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">datetime </span><span style="color:#89DDFF;">:replied_at</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 最后回帖时间</span></span>
<span class="line"><span style="color:#A6ACCD;">      t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">timestamps</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># 关联 user 数据，user 先不加上去</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># t.references user #  最后回复者用户对象</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>命令<code>rails db:migrate</code>，将修改同步到数据库中</p><p>GET /api/v3/hello 简单的 API 测试接口</p><p><img src="https://s2.loli.net/2023/02/23/fIjgH9oC6AxVUtb.png" alt="测试接口"></p><p>（图中的rils是cmder显示不正确，应该是rails）</p><p>创建好</p><p>GET /api/v3/topics 获取话题列表</p><p>GET /api/v3/topics/:id 话题详情</p><p>POST /api/v3/topics 创建新话题</p><p>PUT /api/v3/topics/:id 修改话题</p><p>DELETE /api/v3/topics/:id 删除话题</p><p>POST /api/v3/topics/:id/replies 创建回帖</p><p>GET /api/v3/topics/:id/replies 话题的回帖列表</p><p>POST /api/v3/topics/:id/follow 关注话题</p><p>POST /api/v3/topics/:id/unfollow 取消关注话题</p><p>POST /api/v3/topics/:id/favorite 收藏话题</p><p>POST /api/v3/topics/:id/unfavorite 取消收藏话题</p><p>POST /api/v3/topics/:id/action?type=:type 话题动作接口</p><h2 id="附录" tabindex="-1">附录 <a class="header-anchor" href="#附录" aria-hidden="true">#</a></h2><h3 id="ruby-china-api-接口" tabindex="-1">ruby-china api 接口 <a class="header-anchor" href="#ruby-china-api-接口" aria-hidden="true">#</a></h3><p>GET /api/v3/hello 简单的 API 测试接口</p><p>账号</p><p>GET /api/v3/users 获取热门用户</p><p>GET /api/v3/users/:id 获取某个用户的详细信息</p><p>GET /api/v3/users/me 获取当前用户的完整信息</p><p>GET /api/v3/users/:id/replies 用户回帖列表</p><p>GET /api/v3/users/:id/topics 用户的话题列表</p><p>POST /api/v3/users/:id/block 屏蔽用户</p><p>POST /api/v3/users/:id/unblock 取消屏蔽用户</p><p>GET /api/v3/users/:id/blocked 获取当前用户的屏蔽列表</p><p>POST /api/v3/users/:id/follow 关注用户</p><p>POST /api/v3/users/:id/unfollow 取消关注</p><p>GET /api/v3/users/:id/following 获取用户的关注列表</p><p>GET /api/v3/users/:id/followers 获取用户的关注者列表</p><p>GET /api/v3/users/:id/favorites 获取某个用户的收藏列表</p><p>节点</p><p>GET /api/v3/nodes 获取节点列表</p><p>GET /api/v3/nodes/:id 节点详情</p><p>话题</p><p>GET /api/v3/topics 获取话题列表</p><p>GET /api/v3/topics/:id 话题详情</p><p>POST /api/v3/topics 创建新话题</p><p>PUT /api/v3/topics/:id 修改话题</p><p>DELETE /api/v3/topics/:id 删除话题</p><p>POST /api/v3/topics/:id/replies 创建回帖</p><p>GET /api/v3/topics/:id/replies 话题的回帖列表</p><p>POST /api/v3/topics/:id/follow 关注话题</p><p>POST /api/v3/topics/:id/unfollow 取消关注话题</p><p>POST /api/v3/topics/:id/favorite 收藏话题</p><p>POST /api/v3/topics/:id/unfavorite 取消收藏话题</p><p>POST /api/v3/topics/:id/action?type=:type 话题动作接口</p><p>回帖</p><p>GET /api/v3/replies/:id 获取回帖的详细内容</p><p>POST /api/v3/replies/:id 修改回帖</p><p>DELETE /api/v3/replies/:id 删除回帖</p><p>图片上传</p><p>POST /api/v3/photos 上传附件</p><p>点赞</p><p>POST /api/v3/likes 点赞</p><p>DELETE /api/v3/likes 取消赞</p><p>通知</p><p>GET /api/v3/notifications 获取用户的通知列表</p><p>POST /api/v3/notifications/read 批量将通知设成已读状态</p><p>GET /api/v3/notifications/unread_count 获取未读通知数量</p><p>DELETE /api/v3/notifications/:id 删除某个通知</p><p>DELETE /api/v3/notifications/all 清空通知</p><p>GET 获取指定主题 topics/:topic_id/replies</p><h3 id="cnode-api-设计" tabindex="-1">cnode api 设计 <a class="header-anchor" href="#cnode-api-设计" aria-hidden="true">#</a></h3><p>主题：</p><p>get /topics 主题首页</p><p>get /topic/:id 主题详情</p><p>post /topics 新建主题</p><p>post /topics/update 编辑主题</p><p>主题收藏：</p><p>post /topic_collect/collect 收藏主题</p><p>post /topic_collect/de_collect 取消主题收藏</p><p>get /topic_collect/:loginname 用户所收藏的主题</p><p>评论：</p><p>post /topic/:topic_id/replies 新建评论</p><p>post /reply/:reply_id/ups 为评论点赞</p><p>用户：</p><p>get /user/:loginname 用户详情</p><p>post /accesstoken 验证 accessToken 的正确性</p><p>消息通知：</p><p>get /message/count 获取未读消息数</p><p>bvgget /messages 获取已读和未读消息</p><p>post /message/mark_all 标记全部已读</p><p>post /message/mark_one/:msg_id 标记单个消息为已读</p>`,115),o=[e];function t(r,i,c,y,D,d){return p(),a("div",null,o)}const u=s(l,[["render",t]]);export{A as __pageData,u as default};
