import{_ as t,r as p,o as c,c as r,a as s,d as n,F as i,b as e,e as a}from"./app.873f0dc8.js";const d={},l=s("h1",{id:"\u5FAE\u4FE1\u7F51\u9875\u6388\u6743",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u5FAE\u4FE1\u7F51\u9875\u6388\u6743","aria-hidden":"true"},"#"),e(" \u5FAE\u4FE1\u7F51\u9875\u6388\u6743")],-1),u=e("\u5FAE\u4FE1\u7F51\u9875\u6388\u6743\u6B65\u9AA4\u5DEE\u4E0D\u591A\u6709\u56DB\u6B65\uFF0C\u5177\u4F53\u6587\u6863\u53EF\u67E5\u770B"),h={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noopener noreferrer"},_=e("\u8FD9\u91CC"),k=e("\uFF0C\u6211\u753B\u4E86\u4E0B\u6D41\u7A0B\u56FE\uFF1A"),q=a('<p><img src="https://i.loli.net/2021/09/26/aPZvclQdzDTmjoL.png" alt="\u5FAE\u4FE1\u6388\u6743\u6D41\u7A0B\u56FE"></p><p>\u4EE5\u4E0B\u4E3A\u4EE3\u7801\u5B9E\u6218</p><h2 id="\u7B2C\u4E00\u6B65-\u7528\u6237\u540C\u610F\u6388\u6743-\u83B7\u53D6-code" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E00\u6B65-\u7528\u6237\u540C\u610F\u6388\u6743-\u83B7\u53D6-code" aria-hidden="true">#</a> \u7B2C\u4E00\u6B65\uFF1A\u7528\u6237\u540C\u610F\u6388\u6743\uFF0C\u83B7\u53D6 code</h2><p>\u9700\u5148\u8C03\u7528 <code>/auth</code> \u63A5\u53E3\uFF0C\u4F20\u5165\u5FC5\u4F20\u53C2\u6570 <code>url</code> \u4EE5\u53CA <code>scope</code>\uFF08\u6B64\u4E3A\u53C2\u6570\u540D\uFF09</p><p>\u8BF7\u6C42\u65B9\u5F0F\uFF1AGET</p><ul><li><p>url \u4E3A\u56DE\u8C03\u5730\u5740</p></li><li><p>scope \u6709\u4E24\u4E2A\u53EF\u9009\u53C2\u6570</p><ul><li>snsapi_base \u53EA\u80FD\u83B7\u53D6\u8FDB\u5165\u9875\u9762\u7528\u6237\u7684 openid\uFF0C\u7528\u6237\u65E0\u611F\u77E5\uFF0C\u53EB\u9759\u9ED8\u6388\u6743</li><li>snsapi_userinfo \u80FD\u83B7\u53D6\u7528\u6237\u7684\u57FA\u672C\u4FE1\u606F\uFF0C\u4F46\u9700\u8981\u7528\u6237\u63A5\u53D7\uFF0C\u53EB\u624B\u52A8\u6388\u6743\uFF0C\u5982\u4E0B\u56FE</li></ul></li></ul><p><img src="https://i.loli.net/2021/05/21/gKzl6PTUmQYos4L.png" alt="1599707513545"></p>',7),b=e("\u5177\u4F53\u533A\u522B\u53EF\u524D\u5F80 "),g={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noopener noreferrer"},m=e("\u5FAE\u4FE1\u6587\u6863"),f=e(" \u67E5\u770B"),x=a(`<h2 id="\u7B2C\u4E8C\u6B65-\u901A\u8FC7-code-\u6362\u53D6\u7F51\u9875\u6388\u6743-access-token" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E8C\u6B65-\u901A\u8FC7-code-\u6362\u53D6\u7F51\u9875\u6388\u6743-access-token" aria-hidden="true">#</a> \u7B2C\u4E8C\u6B65\uFF1A\u901A\u8FC7 code \u6362\u53D6\u7F51\u9875\u6388\u6743 access_token</h2><p>\u8FD9\u91CC\u4EE5\u624B\u52A8\u6388\u6743\u4E3A\u4F8B</p><p>\u83B7\u53D6\u5230\u5FAE\u4FE1\u7684 code \u540E\uFF0C\u518D\u8BF7\u6C42 <code>/getUserInfo</code></p><p>\u8BF7\u6C42\u65B9\u5F0F\uFF1A GET</p><p>\u8BF7\u6C42\u53C2\u6570\uFF1Acode\uFF0C\u9700\u8BF7\u6C42 <code>/auth</code> \u83B7\u53D6\u5230 <code>code</code> \u5148\uFF0C\u5982\u679C\u4F60\u5728\u8BF7\u6C42 <code>/auth</code> \u65F6\u4F20\u5165\u7684 <code>scope</code> \u4E3A <code>snsapi_userinfo</code> , \u90A3\u4E48\u8FD4\u56DE\u5FAE\u4FE1\u4E2A\u4EBA\u4FE1\u606F\uFF0C\u5305\u62EC\u5FAE\u4FE1\u540D\uFF0C\u6027\u522B\uFF0C\u6240\u5728\u5730\u533A\uFF0C\u56FD\u7C4D\uFF0C\u5934\u50CF\u7B49\u7B49\uFF0C\u5982\u4E0B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;openid&quot;</span><span class="token operator">:</span><span class="token string">&quot; OPENID&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;nickname&quot;</span><span class="token operator">:</span> <span class="token constant">NICKNAME</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;sex&quot;</span><span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;province&quot;</span><span class="token operator">:</span><span class="token string">&quot;PROVINCE&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;city&quot;</span><span class="token operator">:</span><span class="token string">&quot;CITY&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;country&quot;</span><span class="token operator">:</span><span class="token string">&quot;COUNTRY&quot;</span><span class="token punctuation">,</span>        <span class="token string-property property">&quot;headimgurl&quot;</span><span class="token operator">:</span><span class="token string">&quot;https://thirdwx.qlogo.cn/mmopen/g3MonUZtNHkdmzicIlibx6iaFqAc56vxLSUfpb6n5WKSYVY0ChQKkiaJSgQ1dZuTOgvLLrhJbERQQ4eMsv84eavHiaiceqxibJxCfHe/46&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;privilege&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span> <span class="token string">&quot;PRIVILEGE1&quot;</span> <span class="token string">&quot;PRIVILEGE2&quot;</span>     <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;unionid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;o6_bmasdasdsad6_2sgVt7hMZOPfL&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u4F46\u5982\u679C <code>scope</code> \u4E3A <code>snsapi_base </code> \uFF0C\u8BF7\u6C42\u6210\u529F\u65F6\u53EA\u8FD4\u56DE\u7528\u6237\u7684 <code>openid</code></p><blockquote><p>PS: \u8BF7\u6C42<code>/getOpenId</code>\u3001 <code>/getUserInfo</code> \u6210\u529F\u65F6\u4F1A\u8FD4\u56DE <code>access_token</code>\uFF0C\u4F46\u6B64 <code>access_token</code> \u548C \u5FAE\u4FE1\u670D\u52A1\u7AEF\u5F00\u53D1\u4E2D\u7684 <code>access_token</code> \u4E0D\u540C\uFF0C\u4E00\u4E2A\u662F\u5FAE\u4FE1\u4E0E\u670D\u52A1\u5668\u6253\u4EA4\u9053\uFF08\u5FAE\u4FE1\u7968\u636E\u670D\u52A1\uFF09\uFF0C\u53E6\u4E00\u4E2A\u662F\u5FAE\u4FE1\u7F51\u9875\u7684 OAuth2.0 \u670D\u52A1\uFF08\u7F51\u9875\u6388\u6743\uFF09</p></blockquote><h2 id="\u7B2C\u4E09\u6B65-\u8BF7\u6C42-userinfo" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E09\u6B65-\u8BF7\u6C42-userinfo" aria-hidden="true">#</a> \u7B2C\u4E09\u6B65\uFF1A\u8BF7\u6C42 userInfo</h2><p>\u62FF\u7740 access_token \u548C openid\uFF0C\u53BB\u8BF7\u6C42\u5FAE\u4FE1\u5B98\u65B9\u63A5\u53E3</p><blockquote><p><code>http\uFF1AGET\uFF08\u8BF7\u4F7F\u7528 https \u534F\u8BAE\uFF09 https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&amp;openid=OPENID&amp;lang=zh_CN</code></p></blockquote><p>\u8FD4\u56DE openid\u3001nickname\u3001sex\u3001province\u3001city\u3001country\u3001headimgurl \u7B49\u4FE1\u606F\uFF0C\u62FF\u7740 openid \u548C \u4F60\u60F3\u8981\u7684\u6570\u636E\u8FD4\u56DE\u503C\u539F\u6765 <code>/auth</code> \u53C2\u6570\u4E2D\u7684 url \u4E0A</p><h2 id="\u5B9E\u6218" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u6218" aria-hidden="true">#</a> \u5B9E\u6218</h2><p>\u5148\u8C03\u7528 <code>/auth</code> \u63A5\u53E3\uFF0C\u4F20\u5165\u53C2\u6570 url \u548C scope</p><p>\u8BF7\u6C42\u63A5\u53E3\uFF1A<code>http://192.168.230.209/auth?url=http://192.168.230.209/home&amp;scope=snsapi_userinfo</code></p><p>redis \u5B58 <code>url=http://192.168.230.209/home</code>\uFF0C\u5373\u6700\u540E\u6388\u6743\u5B8C\u6210\u62FF\u5230\u6570\u636E\u540E\u8FD4\u56DE\u7684\u524D\u7AEF\u5730\u5740</p><p>\u5224\u65AD\u53C2\u6570 scope\uFF0C\u5982\u679C\u662F <code>snsapi_userinfo</code>\uFF0C\u7528\u6237\u70B9\u51FB\u6388\u6743\u540E\u8DF3\u8F6C\u81F3 <code>/getWxUserInfo</code> \u63A5\u53E3\uFF1B</p><p>\u5982\u679C\u662F <code>snsapi_base</code>\uFF0C\u9759\u9ED8\u6388\u6743\u540E\u8DF3\u8F6C\u81F3 <code>getOpenId</code> \u63A5\u53E3</p><p>\u8FD9\u91CC\u6211\u4EEC\u4F20\u7684 scope \u4E3A <code>snsapi_userinfo</code>\uFF0C\u6240\u4EE5\u8BF7\u6C42\u6210\u529F\u540E\u4F1A\u6709\u6388\u6743\u9875\u9762</p><p><img src="https://i.loli.net/2021/05/21/gKzl6PTUmQYos4L.png" alt="1599707513545"></p><p>\u70B9\u51FB\u201D\u540C\u610F\u201C\u4F1A\u8DF3\u8F6C\u81F3\u9875\u9762</p><p><code>http://192.168.230.209:8888/api/wechat/getWxUserInfo?code=081UcAFa1s1OAz0o7wGa1wb8vG1UcAFX&amp;state=123</code></p><blockquote><p>PS\uFF1A<code>http://192.168.230.209:8888/api/wechat</code> \u4E3A\u8BE5\u540E\u7AEF\u670D\u52A1\u5730\u5740\uFF0C<code>getWxUserInfo</code> \u4E3A\u8DEF\u7531\uFF08\u5373\u8BF7\u6C42\u63A5\u53E3\uFF09</p></blockquote><p>\u4ECE<code>ctx.request.query</code> \u4E2D\u62FF\u5230 code\uFF0C\u62FF\u7740 code \u8BF7\u6C42 access_token \u670D\u52A1\uFF0Caccess_token \u670D\u52A1\u4E5F\u662F\u5FAE\u4FE1\u5B98\u65B9\u63D0\u4F9B\u7684\u4E00\u4E2A\u65B9\u6CD5</p><blockquote><p><code>\u83B7\u53D6code\u540E\uFF0C\u8BF7\u6C42\u4EE5\u4E0B\u94FE\u63A5\u83B7\u53D6access_token\uFF1A https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</code></p></blockquote><p>\u8BF7\u6C42\u6210\u529F\u7684\u8BDD\uFF0C\u62FF\u7740\u8FD9\u4E2A\u8FD4\u56DE\u503C\u4E2D\u7684 access_token \u548C openid\uFF0C\u8BF7\u6C42 userinfo \u63A5\u53E3\uFF0C\u5728\u4E0A\u6587\u5DF2\u7ECF\u4ECB\u7ECD\u8FC7\uFF0C\u8FD9\u91CC\u4E0D\u505A\u91CD\u590D</p><blockquote><p>\u8FD9\u91CC\u8981\u8BF4\u660E\u7684\u4E00\u70B9\u662F\uFF0C\u5982\u679C\u8BF7\u6C42 access_token \u7684\u8FD4\u56DE code \u4E3A 40029\uFF0C\u8BF4\u660E access_token \u5DF2\u7ECF\u5931\u6548\uFF0C\u6211\u4EEC\u9700\u8981\u91CD\u65B0\u5237\u65B0 access_token</p></blockquote><p>\u62FF\u5230 userinfo \u7684\u8FD4\u56DE\u503C\u540E\uFF0C\u5728\u6700\u5F00\u59CB\u5B58\u5728 redis \u4E2D\u7684 url \u4E0A\u62FC\u63A5 openid\u3001headimgurl \u7B49\u5373\u53EF</p><p>\u8FD9\u91CC\u9700\u8981\u8BF4\u660E\u4E00\u70B9</p><p>\u9700\u8981\u5148\u914D\u7F6E OAuth2.0 \u7F51\u9875\u6388\u6743\u7684\u56DE\u8C03\u9875\u9762\u57DF\u540D\uFF0C\u7C7B\u4F3C\u8FD9\u79CD</p><p><img src="https://i.loli.net/2021/09/27/PufDxSq7m3abZcA.png" alt="\u6388\u6743\u56DE\u8C03\u9875\u9762\u57DF\u540D"></p><h2 id="\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a> \u603B\u7ED3</h2><p>\u4E00\u76F4\u8981\u77E5\u9053\u4E00\u5B9A\uFF0C\u5FAE\u4FE1\u7F51\u9875\u5F00\u53D1\u548C\u8C03\u7528\u5FAE\u4FE1\u7684 JS-SDK \u4E0D\u4E00\u6837\uFF0C\u4E5F\u548C\u5FAE\u4FE1\u670D\u52A1\u7AEF\u5F00\u53D1\u4E0D\u4E00\u6837</p><p>\u5B83\u53EF\u4EE5\u5F53\u521D\u62CE\u51FA\u6765\u8BF4\uFF0C\u5751\u4E5F\u6BD4\u8F83\u5C11\uFF0C\u4E0D\u4F1A\u9047\u5230\u50CF JS-SDK \u90A3\u6837\u7684\u5404\u79CD\u62A5\u9519</p><p>\u53EA\u8981\u77E5\u9053\uFF0C\u5B83\u4E3A\u4E3A\u4E86\u83B7\u53D6 openid \uFF08\u4EE5\u53CA\u5FAE\u4FE1\u4E2A\u4EBA\u4FE1\u606F\uFF09\u800C\u5F04\u7684\u4E00\u4E2A\u670D\u52A1\u5C31\u597D\u4E86</p>`,35);function y(I,v){const o=p("ExternalLinkIcon");return c(),r(i,null,[l,s("p",null,[u,s("a",h,[_,n(o)]),k]),q,s("p",null,[b,s("a",g,[m,n(o)]),f]),x],64)}var O=t(d,[["render",y],["__file","\u5FAE\u4FE1\u7F51\u9875\u6388\u6743.html.vue"]]);export{O as default};
